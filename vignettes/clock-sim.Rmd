---
title: "Simulation of the circadian clock"
author: "Ye Yuan"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Simulation of the circadian clock}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

This vignette documents workflow for circadian clock simulation provided by 
this package. In this vignette, we focus on the classical Leloup & Goldbeter 
model (hereafter LG) of the Drosophila circadian clock focusing on the PER-TIM
negative feedback loop. Refer to the package documentation to the different models 
that this package implemented. Propose addition of new models via Github issues 
(or better yet PRs).

To begin with, we run simulation using the default parameters of the LG model.

# Default parameters of LG model

```{r setup}
library(clockSim)
# Use discrete Leloup and Goldbeter model with default parameters
model <- getOdinGen()$discrete_LG$new()
# Specify time step and total simulation time
#   (0.1hr step, total 2400hr = 100day)
sim_step_hours <- 0.1
sim_total_hours <- 2400
steps <- seq(from = 0, to = sim_total_hours/sim_step_hours)
# Run simulation once
res <- model$run(steps) |> as.data.frame()
# Plot results
#   Phase portrait of the full simulation
#     X = TIM mRNA level (nM)
#     Y = Nuclear PER-TIM complex level (nM)
plot(plot_phase(res, M_T, C_N))
#   Time series
#     subsample the result to 1hr precision for plotting
#     X-axis time tick every 24hr
#     faceted plot of M_T and C_N states (see above)
res$time <- res$step*sim_step_hours
#     plot 10-20day (first 10d DD constant condition)
plot(plot_timeSeries(res, 240, 24*20, 1, 24, M_T, C_N))
#     plot 0-10day (first 10d LD condition)
plot(plot_timeSeries(res, 0, 240, 1, 24, M_T, C_N))

# Compute clock period and power
#   Using 10-20day data (i.e., first 10-day in DD constant condition)
#     provide only M_T series; other series are locked in phase
print(compute_period(res$M_T[240:480])) # FFT method
print(compute_period(res$M_T[240:480], method = "lomb")) # LS periodogram
```
